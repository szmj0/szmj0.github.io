"use strict";const CACHE_NAME="szcache",RESOURCES=[["index.html","update.js"],["manifest.json","favicon.png","icon.png"]];var lastCheckUpdateTime=0;function getResKey(e){var t=registration.scope;t||(t=location.origin);var n=e.url.substring(t.length);return"/"==n.substring(0,1)&&(n=n.substring(1)),(""==n||"/"==n||n.startsWith("#")||n.startsWith("?v=")||n.startsWith("?_="))&&(n="index.html"),n}async function reloadAll(){return caches.open(CACHE_NAME).then(e=>{e.keys().then(function(t){t.forEach(function(t,n,a){if(t){var i,s=t.url.split("/").pop();-1===RESOURCES[1].indexOf(s)&&e.delete(t)}})});var t=registration.scope;RESOURCES[0].forEach(n=>{fetch(t+n).then(a=>{e.put(t+n,a.clone()),"index.html"==n&&e.put(t,a.clone())})})}).catch(e=>{caches.delete(CACHE_NAME)})}async function checkUpdate(){try{var e=registration.scope+"update.js",t=await fetch(e,{cache:"reload"}),n=await t.text();if(!n||!n.match(/^\d+$/))return;var a=await caches.open(CACHE_NAME),t,i;if(!(t=await a.match(e)))return void a.put(e,new Response(n));await t.text()!=n&&reloadAll()}catch(e){}}function cacheOnly(e){return e.respondWith(caches.open(CACHE_NAME).then(t=>t.match(e.request)))}function cacheFirst(e){return e.respondWith(caches.open(CACHE_NAME).then(t=>t.match(e.request).then(n=>n||fetch(e.request).then(n=>(t.put(e.request,n.clone()),n)))))}self.addEventListener("fetch",e=>{if("GET"===e.request.method){var t=getResKey(e.request);if(-1!==RESOURCES[1].indexOf(t))return cacheOnly(e);if(-1!==RESOURCES[0].indexOf(t)){if("index.html"==t){var n=+new Date;n-lastCheckUpdateTime>36e5&&(lastCheckUpdateTime=n,checkUpdate())}return cacheFirst(e)}}}),self.addEventListener("message",e=>{"skipWaiting"!==e.data||self.skipWaiting()}),self.addEventListener("install",e=>e.waitUntil(self.skipWaiting())),self.addEventListener("activate",function(e){return e.waitUntil(async function(){await reloadAll(),await self.clients.claim()}())});